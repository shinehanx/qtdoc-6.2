<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- integrity-build-monolith-app-tutorial.qdoc -->
  <title>Building Qt for Qualcomm Snapdragon 8155P Board on Ubuntu | Qt 6.2</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="index.html">Qt 6.2</a></li>
<li>Building Qt for Qualcomm Snapdragon 8155P Board on Ubuntu</li>
<li id="buildversion">Qt 6.2.3 Reference Documentation</li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
  <link rel="prev" href="integrity-linux-monolith.html" />
  <link rel="next" href="integrity-building-monolith.html" />
<p class="naviNextPrevious headerNavi">
<a class="prevPage" href="integrity-linux-monolith.html">Build Qt with Ubuntu host</a>
<span class="naviSeparator">  &#9702;  </span>
<a class="nextPage" href="integrity-building-monolith.html">Building a monolith project</a>
</p>
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level1"><a href="#creating-a-set-environment-shell-script">Creating a set environment shell script</a></li>
<li class="level1"><a href="#getting-qt-sources">Getting Qt sources</a></li>
<li class="level1"><a href="#building-qt-desktop-for-cross-compiling-tools-usage">Building Qt Desktop for cross-compiling tools usage</a></li>
<li class="level1"><a href="#creating-a-toolchain-file-for-integrity">Creating a toolchain file for INTEGRITY</a></li>
<li class="level1"><a href="#creating-egl-pack">Creating EGL pack</a></li>
<li class="level1"><a href="#configuring-qt-for-integrity">Configuring Qt for INTEGRITY</a></li>
<li class="level1"><a href="#building-qt-for-integrity">Building Qt for INTEGRITY</a></li>
<li class="level1"><a href="#installing-qt">Installing Qt</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">Building Qt for Qualcomm Snapdragon 8155P Board on Ubuntu</h1>
<!-- $$$integrity-building-qt-8155P-on-ubuntu.html-description -->
<div class="descr" id="details">
<p>Having Green Hills INTEGRITY and Qualcomm development environments setup is a required before proceeding. See <a href="integrity-installing-dependencies.html">Installing Platform Dependencies</a>.</p>
<h2 id="creating-a-set-environment-shell-script">Creating a set environment shell script</h2>
<p>To set up the development environment for Qt for INTEGRITY, build Qt from the sources for the Qualcomm Snapdragon 8155P board. Before building Qt for INTEGRITY, set up build environment. Here a batch script to automate that, as it needs to be done before each build.</p>
<p>Create a new shell script <i>setEnvironment.sh</i>, and save it under your home folder. Add the following export commands to the script:</p>
<pre class="cpp plain">
 export PATH=$PATH:/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/comp
 export INTEGRITY_DIR=/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/integrity
 export INTEGRITY_BSP=platform-sa8155
 export INTEGRITY_BUILD_TARGET=chk
 export QC_MULTIMEDIA_INC_DIR=/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/include/amss/multimedia
 export GL_INC_DIR=/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/AMSS/multimedia/graphics/include/public
 export GL_LIB_DIR=/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/rel/libs/base:/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/rel/libs/multimedia/display:/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/rel/libs/multimedia/graphics:/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/rel/libs/platform/:/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/AMSS/multimedia/graphics/opengl/esx/build/integrity/prebuilt/
</pre>
<p>These export paths assume you have used the <code>/work/ghs/*</code> installation directories while installing the MULTI IDE and INTEGRITY (see <a href="integrity-installing-dependencies.html">Installing Platform Dependencies</a>). If you have not used the default directories, adjust the export paths accordingly.</p>
<p>To initialize your build environment, run the following command in a terminal:</p>
<pre class="cpp plain">
 source ~/setEnvironment.sh
</pre>
<div class="admonition note">
<p><b>Note: </b>Run this command in your terminal every time you build Qt, or use the <code>qmake</code> or <code>CMake</code> build systems.</p>
</div>
<h2 id="getting-qt-sources">Getting Qt sources</h2>
<p>You can download the Qt source code from your <a href="https://login.qt.io/login">Qt Account</a>.</p>
<p>You can also get the Qt sources from the Git repo. Qt Wiki has instructions for getting Qt sources from Git, see <a href="https://wiki.qt.io/Building_Qt_5_from_Git#Getting_the_source_code">Getting source code</a>.</p>
<div class="admonition note">
<p><b>Note: </b>Qt sources version must be 6.2 or later.</p>
</div>
<div class="admonition note">
<p><b>Note: </b>The init-repository script initializes the Qt 6 repository and clones various Qt 6 sub-modules (see <a href="https://wiki.qt.io/Building_Qt_5_from_Git#Getting_the_submodule_source_code">Getting the submodule source code</a>). Qt modules supported by Qt for INTEGRITY are listed in <a href="wasm.html#supported-qt-modules">Supported Qt Modules</a>.</p>
</div>
<h2 id="building-qt-desktop-for-cross-compiling-tools-usage">Building Qt Desktop for cross-compiling tools usage</h2>
<p>The cross-compiling Qt requires a host build of Qt being available. During the build, tools such as moc, rcc, qmlcachegen, qsb, and others, are invoked from there. For more detailed information please read <a href="https://www.qt.io/blog/qt-6-build-system">Cross-compiling Qt</a>.</p>
<p>Run the following commands:</p>
<pre class="cpp plain">
 mkdir hostbuild
 cd hostbuild/
 ../qt5/configure -nomake tests -nomake examples -release -prefix /work/ghs/hostbuild
 cmake --build . --parallel 6
 cmake --install .
</pre>
<h2 id="creating-a-toolchain-file-for-integrity">Creating a toolchain file for INTEGRITY</h2>
<p>To cross-compile a project with CMake, one must specify a toolchain file. This CMake-language file sets the right values for the platform name, the compiler/linker used, and a whole bunch of other toolchain-specific things. For Integrity build on Ubuntu create a toolchain.cmake file with content:</p>
<pre class="cpp">
 set(TARGET_ROOT_PATH &quot;/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot&quot;)
 set(CMAKE_BUILD_TYPE &quot;Release&quot;)

 set(CMAKE_C_COMPILER cxintarm64)
 set(CMAKE_CXX_COMPILER cxintarm64)
 set(CMAKE_ASM_COMPILER cxintarm64)

 #generic
 set(CMAKE_SYSTEM_NAME Integrity)
 set(CMAKE_SYSTEM_PROCESSOR arm)
 set(CMAKE_CROSSCOMPILING True)

 set(EGL_FOUND True)
 set(UNIX True)

 set (CMAKE_C_COMPILE_FEATURES c_std_99)
 set (CMAKE_CXX_COMPILE_FEATURES
 cxx_alias_templates
 cxx_alignas
 cxx_alignof
 cxx_attributes
 cxx_auto_type
 cxx_constexp
 cxx_decltype
 cxx_delegating_constructors
 cxx_explicit_conversions
 cxx_extern_templates
 cxx_inheriting_constructors
 cxx_lambdas
 cxx_noexcept
 cxx_nonstatic_member_init
 cxx_nullptr
 cxx_override
 cxx_range_for
 cxx_raw_string_literals
 cxx_reference_qualified_functions
 cxx_rvalue_references
 cxx_static_assert
 cxx_std_17
 cxx_thread_local
 cxx_unicode_literals
 cxx_uniform_initialization
 cxx_unrestricted_unions
 cxx_variadic_macros
 cxx_variadic_templates)

 #base
 set(CMAKE_C_FLAGS  &quot;-bsp $ENV{INTEGRITY_BSP} -os_dir $ENV{INTEGRITY_DIR} -non_shared -startfile_dir=$ENV{INTEGRITY_DIR}/libs/$ENV{INTEGRITY_BSP}/$ENV{INTEGRITY_BUILD_TARGET} --rtos_library_directory=libs/$ENV{INTEGRITY_BSP}/$ENV{INTEGRITY_BUILD_TARGET} --rtos_library_directory=libs/arm64/$ENV{INTEGRITY_BUILD_TARGET} -bigswitch -DINTEGRITY -llibivfs.a -llibposix.a -llibpaged_alloc.a -llibnet.a -llibsocket.a&quot;)
 set(CMAKE_C_FLAGS_DEBUG &quot;-g -Omaxdebug&quot;)
 set(CMAKE_C_FLAGS_RELEASE &quot;-Ospeed -Olink -Omax&quot;)
 set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} --signed_fields --diag_suppress=1,82,228,236,381,611,961,997,1795,1931,1974,3148 --c++17 --thread_local_storage --exceptions --defer_parse_function_templates&quot;)
 set(CMAKE_CXX_FLAGS &quot;${CMAKE_C_FLAGS} --signed_fields --no_implicit_include --link_once_templates -non_shared --new_outside_of_constructor -I $ENV{QC_MULTIMEDIA_INC_DIR}&quot;)
 set(CMAKE_CXX_FLAGS_DEBUG ${CMAKE_C_FLAGS_DEBUG})
 set(CMAKE_CXX_FLAGS_RELEASE &quot;${CMAKE_C_FLAGS_RELEASE}&quot;)
 set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -L${TARGET_ROOT_PATH} -L${TARGET_ROOT_PATH}/apps/ghs_apps_proc/qc_bsp/out/rel/libs/multimedia/graphics -L${TARGET_ROOT_PATH}/apps/ghs_apps_proc/qc_bsp/out/rel/libs/base -L${TARGET_ROOT_PATH}/apps/ghs_apps_proc/qc_bsp/AMSS/multimedia/graphics/opengl/esx/build/integrity/prebuilt -L${TARGET_ROOT_PATH}/apps/ghs_apps_proc/qc_bsp/out/rel/libs/platform -L${TARGET_ROOT_PATH}/apps/ghs_apps_proc/qc_bsp/out/rel/libs/multimedia/display/ --commons&quot;)
 set(CMAKE_FIND_LIBRARY_PREFIXES &quot;lib&quot;)
 set(CMAKE_FIND_LIBRARY_SUFFIXES &quot;.a&quot;)
 set(BUILD_SHARED_LIBS OFF)
 set(CMAKE_EXE_LINKER_FLAGS &quot;&quot;)
 set(QT_CFLAGS_OPTIMIZE_FULL &quot;-Ospeed -Olink -Omax&quot;)
 set(GLSLANG_OSDEP_PATH ../3rdparty/glslang/glslang/OSDependent/Unix)
 set(GL_INC_DIR ${TARGET_ROOT_PATH}/apps/ghs_apps_proc/qc_bsp/AMSS/multimedia/graphics/include/public)
 set(EGL_INCLUDE_DIR ${TARGET_ROOT_PATH}/apps/ghs_apps_proc/qc_bsp/AMSS/multimedia/graphics/include/public)
 set(PKG_EGL_LIBRARY_DIRS ${TARGET_ROOT_PATH})
 set(EGL_LIBRARY ${TARGET_ROOT_PATH}/libeglmegapack.a)
 set(GLESv2_LIBRARY ${TARGET_ROOT_PATH}/libeglmegapack.a)
 set(GLESv2_INCLUDE_DIR ${TARGET_ROOT_PATH}/apps/ghs_apps_proc/qc_bsp/AMSS/multimedia/graphics/include/public)
 set(OPENGL_INCLUDE_DIR ${TARGET_ROOT_PATH}/apps/ghs_apps_proc/qc_bsp/AMSS/multimedia/graphics/include/public)
 set(OPENGL_opengl_LIBRARY ${TARGET_ROOT_PATH}/libeglmegapack.a)
</pre>
<h2 id="creating-egl-pack">Creating EGL pack</h2>
<p>For CMake find and properly detect the EGL module, repack the needed egl libraries into one archive called libeglmegapack:</p>
<pre class="cpp plain">
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/multimedia/graphics/libESXEGL_Adreno.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/multimedia/graphics/libadreno_utils.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/multimedia/graphics/libESXGLESv2_Adreno.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/multimedia/graphics/libadreno_utils.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/multimedia/graphics/libGSLUser.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/multimedia/graphics/libOSUser.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/multimedia/graphics/libpanel.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/integrity/libs/arm64/chk/libivfs.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/platform/libpmem.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/platform/libtzbsp.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/integrity/libs/arm64/chk/libpaged_alloc.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/AMSS/multimedia/graphics/opengl/esx/build/integrity/prebuilt/libglnext-llvm.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/multimedia/display/libopenwfd.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/base/libplanedef.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/platform/liblogger.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/base/librfs_client.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/integrity/libs/arm64/chk/libshm_client.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/base/libmmosalrfs.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/base/libmmosalfile.a
 ar -x ../hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/out/chk/libs/base/libOSAbstraction.a
 ar r libeglmegapack.a *.o
 rm *.o
</pre>
<p>Copy the resulting <code>libeglmegapack.a</code> to your installation directory <code>hlos_dev_boot</code>.</p>
<h2 id="configuring-qt-for-integrity">Configuring Qt for INTEGRITY</h2>
<p>Configure Qt for the Qualcomm Snapdragon 8155P board using these following commands:</p>
<pre class="cpp plain">
 cd /work/ghs/targetbuild // Path to Qt installation directory
 cmake ../qt5/ -DQT_HOST_PATH=/work/ghs/hostbuild/qtbase
 -DCMAKE_TOOLCHAIN_FILE=/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/toolchain_integrity.cmake
 -DQT_QMAKE_TARGET_MKSPEC=devices/integrity-armv8-SA8155P -DBUILD_qtdoc=OFF
 -DBUILD_qttranslations=OFF -DFEATURE_printdialog=OFF --debug-trycompile -DFEATURE_dbus=OFF
 -GNinja -DUNIX=ON
 -DEGL_LIBRARY=/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/libeglmegapack.a
 -DEGL_INCLUDE_DIR=/work/ghs/sa8155/es7/es7_dev_env/hlos_dev_boot/apps/ghs_apps_proc/qc_bsp/AMSS/multimedia/graphics/include/public
 -DFEATURE_dnslookup=OFF -DFEATURE_glib=OFF -DFEATURE_libudev=OFF -DFEATURE_system_pcre2=OFF -DFEATURE_sql_mysql=OFF
 -DCMAKE_INSTALL_PREFIX=/work/ghs/targetbuild
</pre>
<div class="admonition note">
<p><b>Note: </b>INTEGRITY supports only static Qt builds.</p>
</div>
<div class="admonition note">
<p><b>Note: </b><code>QT_HOST_PATH</code> variable introduced in Qt 6. When cross-compiling, this must be set to the install location of Qt for the host platform. It is used to locate tools to be run on the host (moc, rcc, androiddeployqt, and so on).</p>
</div>
<h2 id="building-qt-for-integrity">Building Qt for INTEGRITY</h2>
<p>Build Qt by calling <code>cmake</code> in the terminal. You can run <code>cmake</code> with as many cores on your host machine as you desire. In our example we use six cores:</p>
<pre class="cpp plain">
 cmake --build . --parallel 6
</pre>
<span id="installing-qt-for-sa8155"></span><h2 id="installing-qt">Installing Qt</h2>
<p>If you have not used the configure option <code>-prefix $PWD/qtbase</code> in <a href="configure-linux-device.html#configuring-qt">Configuring Qt</a>, run the following commands in a terminal:</p>
<pre class="cpp plain">
 cd &lt;Qt installation directory&gt;
 cmake --install .
</pre>
<p>If you have used the configure option <code>-prefix $PWD/qtbase</code>, you can use Qt from the build directory, without running the <code>cmake install</code> command.</p>
<p>Qt is now configured and built for the sa8155 board.</p>
</div>
<!-- @@@integrity-building-qt-8155P-on-ubuntu.html -->
<p class="naviNextPrevious footerNavi">
<a class="prevPage" href="integrity-linux-monolith.html">Build Qt with Ubuntu host</a>
<span class="naviSeparator">  &#9702;  </span>
<a class="nextPage" href="integrity-building-monolith.html">Building a monolith project</a>
</p>
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2022 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.<br/>    Qt and respective logos are trademarks of The Qt Company Ltd.     in Finland and/or other countries worldwide. All other trademarks are property
   of their respective owners. </p>
</div>
</body>
</html>
