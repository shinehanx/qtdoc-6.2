<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- qtpurchasing-overview.qdoc -->
  <title>In-App purchasing demo | Qt 6.2</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="index.html">Qt 6.2</a></li>
<li>In-App purchasing demo</li>
<li id="buildversion">Qt 6.2.3 Reference Documentation</li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level1"><a href="#what-is-this-demo">What is this demo?</a></li>
<li class="level1"><a href="#3rd-party-app-stores">3rd party app stores</a></li>
<li class="level1"><a href="#how-does-the-demo-work">How does the demo work</a></li>
<li class="level1"><a href="#in-app-purchases">In-App purchases</a></li>
<li class="level1"><a href="#licenses-and-attributions">Licenses and attributions</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">In-App purchasing demo</h1>
<!-- $$$demos/hangman-brief -->
<p>A complete mobile application that demonstrates purchasing in-app products.</p>
<!-- @@@demos/hangman -->
<!-- $$$demos/hangman-description -->
<div class="descr" id="details">
<h4 id="what-is-this-demo">What is this demo?</h4>
<p class="centerAlign"><img src="images/qthangman-example.png" alt="" /></p><p>This demo is a complete mobile application that demonstrates how it is possible to offer in-app products inside a Qt application, in a cross-platform manner. In order to test the in-app purchase functionality in the example, you must first register the application and its products in the external store. For an introduction on how to do this, see the guides for <a href="qtpurchasing-googleplay.html">Google Play</a> and <a href="qtpurchasing-appstore.html">App Store</a> respectively.</p>
<h4 id="3rd-party-app-stores">3rd party app stores</h4>
<p>The in-app products must be registered in the target stores, before they can be queried or purchased in an application. We recommend using the same identifiers for the products in each store, as it simplifies the code to query and purchase the products.</p>
<ul>
<li><a href="qtpurchasing-googleplay.html">Registering Products in Google Play</a></li>
<li><a href="qtpurchasing-appstore.html">Registering Products in App Store</a></li>
</ul>
<h4 id="how-does-the-demo-work">How does the demo work</h4>
<p>The demo is a QML application that registers QML types to access information about in-app products, as well as to request purchases for those products. These are registered in the external store for the target platform</p>
<p>In-app purchasing are added to application by first adding a Store object. In the demo the Store object is created by the MainView component that is loaded on application startup.</p>
<pre class="qml">
 <span class="type">Store</span> {
     <span class="name">id</span>: <span class="name">iapStore</span>
 }
</pre>
<p>The demo defines a component for displaying a store for purchasing in-app products made available. These products must be first registered with the store object we created above in MainView. There are two products available, the first being a consumable type.</p>
<pre class="qml">
 <span class="type">Product</span> {
     <span class="name">id</span>: <span class="name">product100Vowels</span>
     <span class="name">store</span>: <span class="name">iapStore</span>
     <span class="name">type</span>: <span class="name">Product</span>.<span class="name">Consumable</span>
     <span class="name">identifier</span>: <span class="string">&quot;qt.io.demo.hangman.100vowels&quot;</span>

     <span class="name">onPurchaseSucceeded</span>: {
         <span class="name">console</span>.<span class="name">log</span>(<span class="name">identifier</span> <span class="operator">+</span> <span class="string">&quot; purchase successful&quot;</span>);
         <span class="comment">//Add 100 Vowels</span>
         <span class="name">applicationData</span>.<span class="name">vowelsAvailable</span> <span class="operator">+=</span> <span class="number">100</span>;
         <span class="name">transaction</span>.<span class="name">finalize</span>();
         <span class="name">pageStack</span>.<span class="name">pop</span>();
     }

     <span class="name">onPurchaseFailed</span>: {
         <span class="name">console</span>.<span class="name">log</span>(<span class="name">identifier</span> <span class="operator">+</span> <span class="string">&quot; purchase failed&quot;</span>);
         <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;reason: &quot;</span>
                     <span class="operator">+</span> <span class="name">transaction</span>.<span class="name">failureReason</span> <span class="operator">===</span> <span class="name">Transaction</span>.<span class="name">CanceledByUser</span> ? <span class="string">&quot;Canceled&quot;</span> : <span class="name">transaction</span>.<span class="name">errorString</span>);
         <span class="name">transaction</span>.<span class="name">finalize</span>();
     }
 }
</pre>
<p>This consumable product provides 100 additional vowels to be used when guessing words in the game. When it is successfully purchased, we update the state of the application to include 100 additional vowels. Then we call finalize() on the transaction object to confirm to the platform store that the consumable product has been provided.</p>
<p>The second product is a non-consumable type that will unlock vowels permanently in the future. In addition to updating the application state on purchase, we must make sure to provide a way to restore this purchase on other devices used by the end user. In this case we create a signal handler for onPurchaseRestored.</p>
<pre class="qml">
 <span class="type">Product</span> {
     <span class="name">id</span>: <span class="name">productUnlockVowels</span>
     <span class="name">type</span>: <span class="name">Product</span>.<span class="name">Unlockable</span>
     <span class="name">store</span>: <span class="name">iapStore</span>
     <span class="name">identifier</span>: <span class="string">&quot;qt.io.demo.hangman.unlockvowels&quot;</span>

     <span class="name">onPurchaseSucceeded</span>: {
         <span class="name">console</span>.<span class="name">log</span>(<span class="name">identifier</span> <span class="operator">+</span> <span class="string">&quot; purchase successful&quot;</span>);
         <span class="name">applicationData</span>.<span class="name">vowelsUnlocked</span> <span class="operator">=</span> <span class="number">true</span>;
         <span class="name">transaction</span>.<span class="name">finalize</span>();
         <span class="name">pageStack</span>.<span class="name">pop</span>();
     }

     <span class="name">onPurchaseFailed</span>: {
         <span class="name">console</span>.<span class="name">log</span>(<span class="name">identifier</span> <span class="operator">+</span> <span class="string">&quot; purchase failed&quot;</span>);
         <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;reason: &quot;</span>
                     <span class="operator">+</span> <span class="name">transaction</span>.<span class="name">failureReason</span> <span class="operator">===</span> <span class="name">Transaction</span>.<span class="name">CanceledByUser</span> ? <span class="string">&quot;Canceled&quot;</span> : <span class="name">transaction</span>.<span class="name">errorString</span>);
         <span class="name">transaction</span>.<span class="name">finalize</span>();
     }

     <span class="name">onPurchaseRestored</span>: {
         <span class="name">console</span>.<span class="name">log</span>(<span class="name">identifier</span> <span class="operator">+</span> <span class="string">&quot; purchase restored&quot;</span>);
         <span class="name">applicationData</span>.<span class="name">vowelsUnlocked</span> <span class="operator">=</span> <span class="number">true</span>;
         <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;timestamp: &quot;</span> <span class="operator">+</span> <span class="name">transaction</span>.<span class="name">timestamp</span>);
         <span class="name">transaction</span>.<span class="name">finalize</span>();
         <span class="name">pageStack</span>.<span class="name">pop</span>();
     }
 }
</pre>
<p class="centerAlign"><img src="images/qthangman-store-example.png" alt="" /></p><p>In addition to registering the products, the demo also provide an interface to actually purchase the registered product. The demo defines a custom component called <code>StoreItem</code> to display and handle the purchasing interaction.</p>
<pre class="qml">
 <span class="type">Product</span> {
     <span class="name">id</span>: <span class="name">productUnlockVowels</span>
     <span class="name">type</span>: <span class="name">Product</span>.<span class="name">Unlockable</span>
     <span class="name">store</span>: <span class="name">iapStore</span>
     <span class="name">identifier</span>: <span class="string">&quot;qt.io.demo.hangman.unlockvowels&quot;</span>

     <span class="name">onPurchaseSucceeded</span>: {
         <span class="name">console</span>.<span class="name">log</span>(<span class="name">identifier</span> <span class="operator">+</span> <span class="string">&quot; purchase successful&quot;</span>);
         <span class="name">applicationData</span>.<span class="name">vowelsUnlocked</span> <span class="operator">=</span> <span class="number">true</span>;
         <span class="name">transaction</span>.<span class="name">finalize</span>();
         <span class="name">pageStack</span>.<span class="name">pop</span>();
     }

     <span class="name">onPurchaseFailed</span>: {
         <span class="name">console</span>.<span class="name">log</span>(<span class="name">identifier</span> <span class="operator">+</span> <span class="string">&quot; purchase failed&quot;</span>);
         <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;reason: &quot;</span>
                     <span class="operator">+</span> <span class="name">transaction</span>.<span class="name">failureReason</span> <span class="operator">===</span> <span class="name">Transaction</span>.<span class="name">CanceledByUser</span> ? <span class="string">&quot;Canceled&quot;</span> : <span class="name">transaction</span>.<span class="name">errorString</span>);
         <span class="name">transaction</span>.<span class="name">finalize</span>();
     }

     <span class="name">onPurchaseRestored</span>: {
         <span class="name">console</span>.<span class="name">log</span>(<span class="name">identifier</span> <span class="operator">+</span> <span class="string">&quot; purchase restored&quot;</span>);
         <span class="name">applicationData</span>.<span class="name">vowelsUnlocked</span> <span class="operator">=</span> <span class="number">true</span>;
         <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;timestamp: &quot;</span> <span class="operator">+</span> <span class="name">transaction</span>.<span class="name">timestamp</span>);
         <span class="name">transaction</span>.<span class="name">finalize</span>();
         <span class="name">pageStack</span>.<span class="name">pop</span>();
     }
 }
</pre>
<p>The StoreItem component will display the product data that is queried from the platform's store, and will call the purchase() method on the product when it is clicked by the user.</p>
<pre class="qml">
 <span class="type"><a href="../qtquick/qml-qtquick-text.html">Text</a></span> {
     <span class="name">id</span>: <span class="name">titleText</span>
     <span class="name">text</span>: <span class="name">product</span>.<span class="name">title</span>
     <span class="name">font</span>.bold: <span class="number">true</span>
     <span class="name">anchors</span>.right: <span class="name">priceText</span>.<span class="name">left</span>
     <span class="name">anchors</span>.rightMargin: <span class="name">topLevel</span>.<span class="name">globalMargin</span>
     <span class="name">anchors</span>.top: <span class="name">parent</span>.<span class="name">top</span>
     <span class="name">anchors</span>.topMargin: <span class="name">topLevel</span>.<span class="name">globalMargin</span>
     <span class="name">anchors</span>.left: <span class="name">parent</span>.<span class="name">left</span>
     <span class="name">anchors</span>.leftMargin: <span class="name">topLevel</span>.<span class="name">globalMargin</span>
 }

 <span class="type"><a href="../qtquick/qml-qtquick-text.html">Text</a></span> {
     <span class="name">id</span>: <span class="name">descriptionText</span>
     <span class="name">text</span>: <span class="name">product</span>.<span class="name">description</span>
     <span class="name">anchors</span>.right: <span class="name">priceText</span>.<span class="name">left</span>
     <span class="name">anchors</span>.rightMargin: <span class="name">topLevel</span>.<span class="name">globalMargin</span>
     <span class="name">anchors</span>.left: <span class="name">parent</span>.<span class="name">left</span>
     <span class="name">anchors</span>.leftMargin: <span class="name">topLevel</span>.<span class="name">globalMargin</span>
     <span class="name">anchors</span>.top: <span class="name">titleText</span>.<span class="name">bottom</span>
     <span class="name">anchors</span>.topMargin: <span class="name">topLevel</span>.<span class="name">globalMargin</span> <span class="operator">/</span> <span class="number">2</span>
     <span class="name">wrapMode</span>: <span class="name">Text</span>.<span class="name">WordWrap</span>
 }

 <span class="type"><a href="../qtquick/qml-qtquick-text.html">Text</a></span> {
     <span class="name">id</span>: <span class="name">priceText</span>
     <span class="name">text</span>: <span class="name">product</span>.<span class="name">price</span>
     <span class="name">anchors</span>.right: <span class="name">parent</span>.<span class="name">right</span>
     <span class="name">anchors</span>.rightMargin: <span class="name">topLevel</span>.<span class="name">globalMargin</span>
     <span class="name">anchors</span>.verticalCenter: <span class="name">parent</span>.<span class="name">verticalCenter</span>
 }

 <span class="type"><a href="../qtquick/qml-qtquick-mousearea.html">MouseArea</a></span> {
     <span class="name">anchors</span>.fill: <span class="name">parent</span>
     <span class="name">onClicked</span>: {
         <span class="name">pendingRect</span>.<span class="name">visible</span> <span class="operator">=</span> <span class="number">true</span>;
         <span class="name">spinBox</span>.<span class="name">visible</span> <span class="operator">=</span> <span class="number">true</span>;
         <span class="name">statusText</span>.<span class="name">text</span> <span class="operator">=</span> <span class="string">&quot;Purchasing...&quot;</span>;
         <span class="name">storeItem</span>.<span class="name">state</span> <span class="operator">=</span> <span class="string">&quot;PURCHASING&quot;</span>;
         <span class="name">product</span>.<span class="name">purchase</span>();
     }
     <span class="name">onPressed</span>: {
         <span class="name">storeItem</span>.<span class="name">state</span> <span class="operator">=</span> <span class="string">&quot;PRESSED&quot;</span>;
     }
     <span class="name">onReleased</span>: {
         <span class="name">storeItem</span>.<span class="name">state</span> <span class="operator">=</span> <span class="string">&quot;NORMAL&quot;</span>;
     }
 }
</pre>
<p>If you are planning to use QML in your project with purchasing functionality, check out <a href="qtpurchasing-gettingstarted-qml.html">Getting Started with Qt Purchasing in QML</a>.</p>
<p>Android and iOS use the base classes. From base classes there are derivative classes for android and ios:</p>
<ul>
<li><a href="qtpurchasing-baseclasses.html">Base Classes</a></li>
<li><a href="qtpurchasing-androidclasses.html">Demo Android Classes</a></li>
<li><a href="qtpurchasing-iosclasses.html">Demo iOS Classes</a></li>
</ul>
<h4 id="in-app-purchases">In-App purchases</h4>
<p>In-app purchases are a way to monetize an application. These purchases are made from inside the application and can include anything from unlocking content to virtual items. The demo uses the system APIs for in-app purchases, which means the purchase process is more familiar to the user, and the information already stored by the platform (such as credit card information) can be used to simplify the purchase process.</p>
<h4 id="licenses-and-attributions">Licenses and attributions</h4>
<p>In regards to deploying the demo on Android see <a href="whatsnew62.html#android">Android</a> GNU C++ Run-time Licensing for more information.</p>
<p>Files:</p>
<ul>
<li><a href="qtdoc-demos-hangman-cmakelists-txt.html">demos/hangman/CMakeLists.txt</a></li>
<li><a href="qtdoc-demos-hangman-hangman-pro.html">demos/hangman/hangman.pro</a></li>
<li><a href="qtdoc-demos-hangman-hangmangame-cpp.html">demos/hangman/hangmangame.cpp</a></li>
<li><a href="qtdoc-demos-hangman-hangmangame-h.html">demos/hangman/hangmangame.h</a></li>
<li><a href="qtdoc-demos-hangman-main-cpp.html">demos/hangman/main.cpp</a></li>
<li><a href="qtdoc-demos-hangman-main-qml.html">demos/hangman/main.qml</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-android-androidinappproduct-cpp.html">demos/hangman/purchasing/android/androidinappproduct.cpp</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-android-androidinappproduct-h.html">demos/hangman/purchasing/android/androidinappproduct.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-android-androidinapppurchasebackend-cpp.html">demos/hangman/purchasing/android/androidinapppurchasebackend.cpp</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-android-androidinapppurchasebackend-h.html">demos/hangman/purchasing/android/androidinapppurchasebackend.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-android-androidinapptransaction-cpp.html">demos/hangman/purchasing/android/androidinapptransaction.cpp</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-android-androidinapptransaction-h.html">demos/hangman/purchasing/android/androidinapptransaction.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-android-androidjni-cpp.html">demos/hangman/purchasing/android/androidjni.cpp</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-inapp-inappproduct-cpp.html">demos/hangman/purchasing/inapp/inappproduct.cpp</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-inapp-inappproduct-h.html">demos/hangman/purchasing/inapp/inappproduct.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-inapp-inapppurchasebackend-cpp.html">demos/hangman/purchasing/inapp/inapppurchasebackend.cpp</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-inapp-inapppurchasebackend-h.html">demos/hangman/purchasing/inapp/inapppurchasebackend.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-inapp-inappstore-cpp.html">demos/hangman/purchasing/inapp/inappstore.cpp</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-inapp-inappstore-h.html">demos/hangman/purchasing/inapp/inappstore.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-inapp-inapptransaction-cpp.html">demos/hangman/purchasing/inapp/inapptransaction.cpp</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-inapp-inapptransaction-h.html">demos/hangman/purchasing/inapp/inapptransaction.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-ios-iosinapppurchasebackend-h.html">demos/hangman/purchasing/ios/iosinapppurchasebackend.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-ios-iosinapppurchaseproduct-h.html">demos/hangman/purchasing/ios/iosinapppurchaseproduct.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-ios-iosinapppurchasetransaction-h.html">demos/hangman/purchasing/ios/iosinapppurchasetransaction.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-qmltypes-inappproductqmltype-cpp.html">demos/hangman/purchasing/qmltypes/inappproductqmltype.cpp</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-qmltypes-inappproductqmltype-h.html">demos/hangman/purchasing/qmltypes/inappproductqmltype.h</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-qmltypes-inappstoreqmltype-cpp.html">demos/hangman/purchasing/qmltypes/inappstoreqmltype.cpp</a></li>
<li><a href="qtdoc-demos-hangman-purchasing-qmltypes-inappstoreqmltype-h.html">demos/hangman/purchasing/qmltypes/inappstoreqmltype.h</a></li>
<li><a href="qtdoc-demos-hangman-qml-gameview-qml.html">demos/hangman/qml/GameView.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-guesswordview-qml.html">demos/hangman/qml/GuessWordView.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-hangman-qml.html">demos/hangman/qml/Hangman.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-howtoview-qml.html">demos/hangman/qml/HowToView.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-key-qml.html">demos/hangman/qml/Key.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-letter-qml.html">demos/hangman/qml/Letter.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-letterselector-qml.html">demos/hangman/qml/LetterSelector.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-mainview-qml.html">demos/hangman/qml/MainView.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-pageheader-qml.html">demos/hangman/qml/PageHeader.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-scoreitem-qml.html">demos/hangman/qml/ScoreItem.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-simplebutton-qml.html">demos/hangman/qml/SimpleButton.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-splashscreen-qml.html">demos/hangman/qml/SplashScreen.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-storeitem-qml.html">demos/hangman/qml/StoreItem.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-storeview-qml.html">demos/hangman/qml/StoreView.qml</a></li>
<li><a href="qtdoc-demos-hangman-qml-word-qml.html">demos/hangman/qml/Word.qml</a></li>
<li><a href="qtdoc-demos-hangman-resources-qrc.html">demos/hangman/resources.qrc</a></li>
</ul>
</div>
<!-- @@@demos/hangman -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2022 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.<br/>    Qt and respective logos are trademarks of The Qt Company Ltd.     in Finland and/or other countries worldwide. All other trademarks are property
   of their respective owners. </p>
</div>
</body>
</html>
