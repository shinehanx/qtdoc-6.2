<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- android-deploying-application.qdoc -->
  <title>Deploying an Application on Android | Qt 6.2</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="index.html">Qt 6.2</a></li>
<li>Deploying an Application on Android</li>
<li id="buildversion">Qt 6.2.3 Reference Documentation</li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
  <link rel="prev" href="examples-android.html" />
  <link rel="next" href="android-openssl-support.html" />
<p class="naviNextPrevious headerNavi">
<a class="prevPage" href="examples-android.html">Qt for Android Examples</a>
<span class="naviSeparator">  &#9702;  </span>
<a class="nextPage" href="android-openssl-support.html">Adding OpenSSL Support for Android</a>
</p>
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level1"><a href="#android-application-bundle">Android Application Bundle</a></li>
<li class="level2"><a href="#generating-the-application-bundle">Generating the Application Bundle</a></li>
<li class="level1"><a href="#android-package-templates">Android Package Templates</a></li>
<li class="level2"><a href="#androidmanifest-xml">AndroidManifest.xml</a></li>
<li class="level2"><a href="#java-code">Java Code</a></li>
<li class="level2"><a href="#resources">Resources</a></li>
<li class="level1"><a href="#customizing-the-package-templates">Customizing the Package Templates</a></li>
<li class="level2"><a href="#resources">Resources</a></li>
<li class="level2"><a href="#custom-java-code">Custom Java Code</a></li>
<li class="level2"><a href="#assets">Assets</a></li>
<li class="level2"><a href="#android-libraries">Android Libraries</a></li>
<li class="level1"><a href="#building-the-android-application">Building the Android Application</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">Deploying an Application on Android</h1>
<!-- $$$deployment-android.html-description -->
<div class="descr" id="details">
<p>This article describes the technical steps required to deploy a Qt application to an Android device.</p>
<div class="admonition note">
<p><b>Note: </b><a href="../qtcore/android-deploy-qt-tool.html">The androiddeployqt Tool</a> automates this process.</p>
</div>
<h2 id="android-application-bundle">Android Application Bundle</h2>
<p>Applications on Android can be packaged in two ways; either as Application Package (APK) or Android App Bundle (AAB). Both are ZIP files which follow a predefined directory structure. The difference between the two is that APK files can be deployed and executed on a device, whereas AAB is intended to be interpreted by the Google Play store and is used to generate APK files for different device architectures.</p>
<p>For testing the application locally, the APK format is the most appropriate, as this can be uploaded directly to the device and run. For distribution to the Google Play store, it is recommended to use AAB instead, which has a similar layout. The added convenience of AAB is that you can include all target ABIs in the same bundle without increasing the size of the actual package downloaded by your users. When using AAB, the Google Play store generates optimized APK packages for the devices issuing the download request and automatically signs them with your publisher key.</p>
<p>For more information on the AAB format, see <a href="https://developer.android.com/guide/app-bundle">the Android App Bundles</a>.</p>
<p>In either case, the application bundle is generated from a specific directory structure that contains the <code>.so</code> file of your code, as well as all Qt's dependencies needed by your application. In addition, any <code>.jar</code> files, Java code, assets, resources and <code>.xml</code> files are included.</p>
<h3 id="generating-the-application-bundle">Generating the Application Bundle</h3>
<p>It is recommended to use Qt Creator or the Makefile created by qmake or CMake to create the application bundle.</p>
<p>All the steps described here are automatically handled by the build script and the <a href="../qtcore/android-deploy-qt-tool.html#androiddeployqt">androiddeployqt deployment tool</a>, which are run by Qt Creator by default.</p>
<div class="admonition note">
<p><b>Note: </b>If you prefer building Android packages from the command line, see <a href="deployment-android.html#building-the-android-application">Building the Android Application</a>.</p>
</div>
<h2 id="android-package-templates">Android Package Templates</h2>
<p>The default templates used by Qt are found in <code>$Qt_install_dir/src/android/templates</code>. The first step of making a custom package is to copy these files into an empty directory, for example <code>android</code>, under your project. Then, you need to define that path in your project's <code>.pro</code> file, using the variable <a href="../qmake/qmake-variable-reference.html#android-package-source-dir">ANDROID_PACKAGE_SOURCE_DIR</a>:</p>
<pre class="cpp plain">
 android {
     ANDROID_PACKAGE_SOURCE_DIR = $$PWD/android

     DISTFILES += \
         android/AndroidManifest.xml \
         android/build.gradle \
         android/res/values/libs.xml
 }
</pre>
<p>Qt Creator copies the package templates to your Android build directory (<i>$ANDROID_BUILD_DIR=$BUILD_DIR/android-build</i>) into your project build directory (<i>$BUILD_DIR</i>). If you want to build from the command line, use the following after running <code>qmake</code> or <code>CMake</code>:</p>
<pre class="cpp">
 make <span class="operator">-</span>j$(nproc) apk_install_target
</pre>
<p>The previous command copies the application's binaries and resources into the $ANDROID_BUILD_DIR. The build directory acts now as the packaging directory, which the application bundle is created from. The main parts of the package templates are described in the following sections.</p>
<h3 id="androidmanifest-xml">AndroidManifest.xml</h3>
<p>The <code>AndroidManifest.xml</code> file gives detailed meta-information about your application. This information is used to customize your application bundle and by the target device to decide which features to enable, the default orientation of the application, and so on. In addition, it's used by the Google Play Store for information on the version code, device support, package name, and lots more. The Android Manifest is also used to define <a href="android-services.html">Android Services</a>, and custom <a href="https://developer.android.com/guide/components/activities/intro-activities">Android Activities</a>.</p>
<p>For more information about the <code>AndroidManifest.xml</code>, see <a href="android-manifest-file-configuration.html">Android Manifest file documentation</a>.</p>
<h3 id="java-code">Java Code</h3>
<p>Under <code>$Qt_install_dir/src/android/java/src/org/qtproject/qt/android/bindings/</code> are the files comprising the Java code of the Android application. This Java code is compiled under $ANDROID_BUILD_DIR and added to the application bundle. The regular Android application launcher is a Java process, so Qt applications have a Java-based entry point. The code in here will load the required Qt libraries, based on the meta-information given in Manifest file.</p>
<p>After loading the libraries, the Java code will call into the application's native <code>main()</code> function on a new thread and the application will launch. At this point, the Java code in the templates is used to delegate events from Android into Qt.</p>
<p>One thing to note about the files in this directory is that they can contain code specific to certain Android versions. Based on the minimum required Android API level of your application it might be necessary to remove some of this code. This is done automatically by <code>androiddeployqt</code> and Qt Creator during packaging.</p>
<p>If your minimum Android API level is 20 or lower, the code below is removed before building, since it's not a supported API on Android API level 20. However, if your minimum API level is 21 or higher, it is left in:</p>
<pre class="cpp">
 <span class="comment">//@ANDROID-21</span>
     @Override
     <span class="keyword">public</span> <span class="type">void</span> onActivityReenter(<span class="type">int</span> resultCode<span class="operator">,</span> Intent data)
     {
         <span class="comment">// Do something</span>
         <span class="keyword">return</span> super<span class="operator">.</span>onActivityReenter(resultCode<span class="operator">,</span> data);
     }
 <span class="comment">//@ANDROID-21</span>
</pre>
<h3 id="resources">Resources</h3>
<p>Under the <code>$Qt_instal_dir/src/android/templates/res/</code> folder are Android resources that can be accessed from the <code>AndroidManifest.xml</code> and Java code used by all Qt applications.</p>
<h4 id="libs-xml">libs.xml</h4>
<p>This file can be found at <code>$Qt_instal_dir/src/android/templates/res/values/libs.xml</code>. One of the files containing meta information about the deployment of the application is <code>libs.xml</code>. It consists of the following values:</p>
<ul>
<li><code>bundled_libs</code>: Libraries in the package's library folder which should be loaded on start-up. Library names should be specified without the <code>lib</code> prefix and <code>.so</code> suffix.</li>
<li><code>qt_libs</code>: Qt libraries which should be loaded on start-up. When bundled deployment is used, these are expected to be found inside the <code>APK</code>'s library folder.</li>
</ul>
<div class="admonition note">
<p><b>Note: </b>Ministro is no longer maintained.</p>
</div>
<h4 id="strings-xml">strings.xml</h4>
<p>This file can be found at <code>$Qt_instal_dir/src/android/java/res/values/strings.xml</code>. The <code>strings.xml</code> file contains strings used by the <code>AndroidManifest.xml</code> and by the deployment mechanisms.</p>
<p>In particular, the application name and the name of the application binary can be specified here. There are also strings that contain additional libraries that should be loaded and <code>JAR</code> files which should be included in the class path.</p>
<h4 id="gradle-files">Gradle Files</h4>
<p>The main Gradle build file can be found at <code>$Qt_instal_dir/src/android/templates/build.gradle</code>. This file is required by the Gradle build system used by Android to generate the application's APK. For more information, see <a href="https://developer.android.com/studio/build#build-files">Android Build Configuration Files</a>.</p>
<h2 id="customizing-the-package-templates">Customizing the Package Templates</h2>
<h3 id="resources">Resources</h3>
<p>Put any resources used by your application under <code>$ANDROID_PACKAGE_SOURCE_DIR/res/</code>. A typical example of resources customization which should be placed here are the icons used by the application launcher to show your application.</p>
<h3 id="custom-java-code">Custom Java Code</h3>
<p>Place any Java code under the path <code>$ANDROID_PACKAGE_SOURCE_DIR/src/</code>. Any code here can be used with your application, for example you can call Java methods from within Qt code. For more information, see <a href="../qtcore/qtcore-platform-androidnotifier-example.html">Qt Android Notifier Example</a>.</p>
<p>When using Qt Creator, add the Java files to your project using <a href="../qmake/qmake-variable-reference.html#distfiles">DISTFILES</a>, so they are visible under the project files.</p>
<h3 id="assets">Assets</h3>
<p>You can place any assets that are intended to be accessed by Java code under <code>$ANDROID_PACKAGE_SOURCE_DIR/assets/</code>. For more information on using assets with Qt, see <a href="porting-to-android.html">Porting to Android</a>.</p>
<div class="admonition note">
<p><b>Note: </b>Using <a href="../qtcore/resources.html">The Qt Resource System</a> entails having <code>.qrc</code> files bundled in the <code>.so</code> files which must be unpacked first to be loaded by the linker, while the Android assets are compressed in the <i>.apk</i> and can be directly used in your application. That means using the Android assets can take up less space, but it's not a cross-platform solution with Qt.</p>
</div>
<h3 id="android-libraries">Android Libraries</h3>
<p>Under <code>$ANDROID_PACKAGE_SOURCE_DIR/libs</code> in your custom package directory, it's possible to place libraries that should be included in the application bundle. <code>JAR</code> libraries should be placed directly under <code>$ANDROID_PACKAGE_SOURCE_DIR/libs/</code>, while shared libraries should be put in a subdirectory named after the target ABI of the libraries. The supported ABIs are: armeabi-v7a, arm64-v8a, x86, x86_64.</p>
<p>For more information, see also <a href="android-3rdparty-libs.html">Third-party Android Libraries</a>.</p>
<h2 id="building-the-android-application">Building the Android Application</h2>
<p>Starting from Qt 5.14.0, you may use the <i>&quot;aab&quot;</i> or <i>&quot;apk&quot;</i> build targets from the Makefile directly to build the application bundle. Use the following command to generate an AAB:</p>
<pre class="cpp plain">
 make -j$(nproc) aab
</pre>
<p>Or to generate the APK:</p>
<pre class="cpp plain">
 make -j$(nproc) apk
</pre>
<p>Under the hood, your Qt code is built and copied to the $ANDROID_BUILD_DIR, then <a href="http://www.gradle.org">Gradle</a> is used to build the Java code and package the application. If an APK intended for release is built, then it should be signed with <code>jarsigner</code> and aligned with <code>zipalign</code>. For more information on signing the package with Qt Creator, see <a href="http://doc.qt.io/qtcreator/creator-deploying-android.html#signing-android-packages">Signing Android packages</a>.</p>
</div>
<!-- @@@deployment-android.html -->
<p class="naviNextPrevious footerNavi">
<a class="prevPage" href="examples-android.html">Qt for Android Examples</a>
<span class="naviSeparator">  &#9702;  </span>
<a class="nextPage" href="android-openssl-support.html">Adding OpenSSL Support for Android</a>
</p>
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2022 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.<br/>    Qt and respective logos are trademarks of The Qt Company Ltd.     in Finland and/or other countries worldwide. All other trademarks are property
   of their respective owners. </p>
</div>
</body>
</html>
